<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SQL TOURNAMENT PRO - ADVANCE DETAIL EDITION</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --accent: #00ff88; --gold: #ffd700; --bg: #050505; --card: #121212; --border: #222; --red: #ff4444; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Poppins', sans-serif; overflow-x: hidden; }

        /* Main App Header */
        header { background: #000; padding: 15px; border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .pfp-nav { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--gold); cursor: pointer; background: #222; object-fit: cover; }

        /* Navigation */
        .tabs { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #080808; }
        .tab-btn { padding: 10px 20px; border-radius: 25px; background: #111; border: 1px solid var(--border); color: #888; font-size: 0.75rem; font-weight: 700; white-space: nowrap; cursor: pointer; }
        .tab-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }

        /* Match List View */
        .match-list { padding: 15px 15px 100px; }
        .m-card { background: var(--card); border-radius: 18px; border: 1px solid var(--border); margin-bottom: 15px; overflow: hidden; }
        .m-card-header { position: relative; height: 100px; }
        .m-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .m-tag { position: absolute; top: 10px; right: 10px; background: var(--accent); color: #000; font-size: 0.6rem; font-weight: 800; padding: 3px 8px; border-radius: 5px; }
        
        .m-card-body { padding: 15px; }
        .m-title { font-size: 1rem; font-weight: 800; color: #fff; margin-bottom: 10px; display: block; }
        .m-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .m-item { font-size: 0.75rem; color: #aaa; }
        .m-item b { color: var(--gold); display: block; font-size: 0.85rem; }

        /* Detail Page (Full Screen Overlay) */
        .detail-page { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; flex-direction: column; overflow-y: auto; }
        .detail-header { position: sticky; top: 0; background: #000; padding: 20px; display: flex; align-items: center; gap: 20px; border-bottom: 1px solid var(--border); }
        .detail-content { padding: 20px; }
        .info-box { background: var(--card); border-radius: 15px; padding: 20px; border: 1px solid var(--border); margin-bottom: 20px; }
        .prize-row { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding: 10px 0; }
        .rule-item { font-size: 0.8rem; color: #aaa; margin-bottom: 8px; display: flex; gap: 10px; }

        /* Chat Modal (Your New UI) */
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); justify-content:center; align-items:center; z-index: 5000; padding: 20px; }
        .modal-box { width:100%; max-width:400px; background:#111; border-radius:15px; padding:20px; border:1px solid var(--gold); }
        .chat-box { height:250px; overflow-y:auto; border:1px solid #333; padding:10px; border-radius:8px; margin-bottom:15px; background: #000; }
        .msg { margin: 8px 0; font-size: 0.85rem; }
        .user { text-align: right; color: var(--accent); }
        .ai { text-align: left; color: #fff; }
        .chat-input { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }

        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: 800; font-size: 0.9rem; cursor: pointer; transition: 0.3s; }
        .btn-join { background: var(--accent); color: #000; }
        .ai-fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #000; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.5); z-index: 1000; }
    </style>
</head>
<body>

    <header>
        <h2 style="font-size:0.9rem; color:var(--gold); margin:0;">SQL TOURNAMENT PRO</h2>
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="pfp-nav" id="nav-pfp" onclick="alert('Profile Settings coming soon')">
    </header>

    <div class="tabs">
        <button class="tab-btn active">ALL MATCHES</button>
        <button class="tab-btn">MY ENTRIES</button>
    </div>

    <main class="match-list" id="match-container">
        </main>

    <div id="detail-page" class="detail-page">
        <div class="detail-header">
            <i class="fas fa-arrow-left" onclick="closeDetails()" style="font-size:1.2rem; cursor:pointer;"></i>
            <h3 id="det-title" style="margin:0;">MATCH DETAILS</h3>
        </div>
        <div class="detail-content" id="det-content">
            </div>
    </div>

    <div class="modal" id="aiModal">
        <div class="modal-box">
            <h3 style="margin-top:0; color:var(--gold);">AI ASSISTANT</h3>
            <div class="chat-box" id="chatBox"></div>
            <input class="chat-input" id="userInput" placeholder="Ask about match timing..." />
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn-main btn-join" onclick="sendToAI()">SEND</button>
                <button class="btn-main" style="background:#333; color:#fff;" onclick="closeAI()">CLOSE</button>
            </div>
        </div>
    </div>

    <div class="ai-fab" onclick="openAI()"><i class="fas fa-robot"></i></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAI, getGenerativeModel } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-ai.js";

        // CONFIGS
        const firebaseConfig = {
            apiKey: "AIzaSyBvObxADcAior6R_or9O6UmWsFT8do1GkI",
            authDomain: "sqladmin-ff04d.firebaseapp.com",
            projectId: "sqladmin-ff04d",
            appId: "1:539086978850:web:261e6a0cf3c9a2aa29ef7b"
        };
        const cloudName = "debp1kjtm";
        const uploadPreset = "sql_admin";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const ai = getAI(app);
        const model = getGenerativeModel(ai, { model: "gemini-1.5-flash" });

        let allMatches = {};

        // 1. Load Match List
        onSnapshot(collection(db, "matches"), snap => {
            const container = document.getElementById('match-container');
            container.innerHTML = "";
            snap.forEach(d => {
                const m = d.data();
                allMatches[d.id] = m;
                container.innerHTML += `
                <div class="m-card" onclick="openDetails('${d.id}')">
                    <div class="m-card-header">
                        <img src="https://staticg.sportskeeda.com/editor/2022/03/f305e-16475141042780-1920.jpg" class="m-img">
                        <div class="m-tag">${m.type}</div>
                    </div>
                    <div class="m-card-body">
                        <b class="m-title">${m.map} - MATCH #${d.id.slice(-4)}</b>
                        <div class="m-grid">
                            <div class="m-item">WIN PRIZE<b>₹${m.win}</b></div>
                            <div class="m-item">ENTRY FEE<b>₹${m.entry}</b></div>
                        </div>
                        <button class="btn-main btn-join">VIEW FULL DETAILS</button>
                    </div>
                </div>`;
            });
        });

        // 2. Open Detailed Page
        window.openDetails = (id) => {
            const m = allMatches[id];
            const page = document.getElementById('detail-page');
            document.getElementById('det-title').innerText = `${m.map} Detail View`;
            
            document.getElementById('det-content').innerHTML = `
                <div class="info-box">
                    <h4 style="margin:0; color:var(--accent);">MATCH INFORMATION</h4>
                    <div class="prize-row"><span>Mode:</span><b>${m.type}</b></div>
                    <div class="prize-row"><span>Map:</span><b>${m.map}</b></div>
                    <div class="prize-row"><span>Total Slots:</span><b>${m.total}</b></div>
                    <div class="prize-row"><span>Joined:</span><b>${m.joined}</b></div>
                </div>

                <div class="info-box">
                    <h4 style="margin:0; color:var(--gold);">PRIZE DISTRIBUTION</h4>
                    <div class="prize-row"><span>1st Rank:</span><b>₹${m.win}</b></div>
                    <div class="prize-row"><span>Per Kill:</span><b>₹0 (Classic)</b></div>
                </div>

                <div class="info-box">
                    <h4 style="margin:0; color:var(--red);">RULES & POLICY</h4>
                    <div class="rule-item"><i class="fas fa-check-circle"></i> No Emulators Allowed.</div>
                    <div class="rule-item"><i class="fas fa-check-circle"></i> Hacks/Script results in Ban.</div>
                    <div class="rule-item"><i class="fas fa-check-circle"></i> Join 10 min before Start.</div>
                </div>

                <div style="background:#000; padding:15px; border-radius:12px; border:1px dashed #333; margin-bottom:20px;">
                    <p style="font-size:0.6rem; color:#666; margin:0;">PAYMENT UPI:</p>
                    <b style="color:var(--accent);">rizwanhasan90122778623@ybl</b>
                </div>

                <button class="btn-main btn-join" onclick="initiatePayment('${id}')">JOIN MATCH (₹${m.entry})</button>
            `;
            page.style.display = 'flex';
        };

        window.closeDetails = () => document.getElementById('detail-page').style.display = 'none';

        // 3. AI Logic (Gemini)
        window.sendToAI = async () => {
            const input = document.getElementById('userInput');
            const chatBox = document.getElementById('chatBox');
            const text = input.value.trim();
            if(!text) return;

            addMsg(text, 'user');
            input.value = "";

            try {
                const res = await model.generateContent(`User says: ${text}. You are SQL Tournament assistant. Reply shortly.`);
                addMsg(res.response.text(), 'ai');
            } catch(e) { addMsg("AI busy, try later.", 'ai'); }
        };

        function addMsg(text, type) {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerText = text;
            const cb = document.getElementById('chatBox');
            cb.appendChild(div);
            cb.scrollTop = cb.scrollHeight;
        }

        window.openAI = () => document.getElementById('aiModal').style.display = 'flex';
        window.closeAI = () => document.getElementById('aiModal').style.display = 'none';
    </script>
</body>
    </html>

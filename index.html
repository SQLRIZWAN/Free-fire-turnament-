<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>SQL TOURNAMENT PRO - ULTIMATE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { 
            --accent: #00ff88; --gold: #ffd700; --bg: #050505; 
            --card: #121212; --border: #222; --red: #ff4444; 
            --profit: #00ff66; --loss: #ff3333;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Poppins', sans-serif; overflow-x: hidden; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { display: none; }

        /* Header */
        header { 
            background: #000; padding: 12px 15px; border-bottom: 2px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .header-info h1 { font-size: 0.85rem; color: var(--gold); margin: 0; letter-spacing: 1px; }
        .pfp-nav { width: 35px; height: 35px; border-radius: 50%; border: 1.5px solid var(--gold); object-fit: cover; cursor: pointer; background: #222; }

        /* Filter Tabs */
        .nav-scroll { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #080808; }
        .nav-btn { 
            padding: 8px 18px; border-radius: 20px; background: #111; border: 1px solid var(--border);
            color: #777; font-size: 0.7rem; font-weight: 700; white-space: nowrap; cursor: pointer; transition: 0.3s;
        }
        .nav-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }

        /* Match Grid (2 Columns) */
        .match-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px 10px 100px; }
        .m-card { background: var(--card); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; position: relative; }
        .m-type-tag { position: absolute; top: 5px; right: 8px; font-size: 0.5rem; color: var(--gold); font-weight: 800; z-index: 2; text-transform: uppercase; }
        .m-img { width: 100%; height: 65px; object-fit: cover; opacity: 0.4; background: #333; }
        
        .m-content { padding: 8px; text-align: center; }
        .m-title { font-size: 0.7rem; font-weight: 800; display: block; margin-bottom: 5px; color: #fff; }
        
        .m-stats { display: flex; justify-content: space-around; background: #000; padding: 5px; border-radius: 8px; margin-bottom: 8px; }
        .stat-item span { display: block; font-size: 0.45rem; color: #666; }
        .stat-item b { font-size: 0.65rem; }
        .win-amt { color: var(--profit); }
        .entry-amt { color: var(--gold); }

        .slot-box { padding: 0 5px 8px; }
        .slot-bar { height: 4px; background: #222; border-radius: 10px; overflow: hidden; margin-bottom: 4px; }
        .slot-fill { height: 100%; background: var(--accent); transition: 1s; }
        .slot-info { display: flex; justify-content: space-between; font-size: 0.5rem; font-weight: 700; }
        .waiting-text { color: var(--red); }

        .btn-join { width: 100%; padding: 8px; border: none; background: var(--accent); color: #000; font-weight: 900; font-size: 0.7rem; cursor: pointer; border-radius: 5px; }

        /* Sidebar Profile */
        #sidebar { 
            position: fixed; top: 0; left: -100%; width: 85%; height: 100%; 
            background: #000; z-index: 2000; transition: 0.4s; padding: 30px 20px;
            border-right: 2px solid var(--gold); overflow-y: auto;
        }
        .profile-section { text-align: center; margin-bottom: 30px; }
        .pfp-container { position: relative; display: inline-block; }
        .pfp-main { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--gold); object-fit: cover; background: #111; }
        .pfp-upload-icon { 
            position: absolute; bottom: 0; right: 5px; background: var(--gold); 
            color: #000; width: 30px; height: 30px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #000;
        }

        .balance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .bal-card { padding: 12px; border-radius: 12px; background: #0c0c0c; border: 1px solid #1a1a1a; text-align: center; }
        .bal-card span { font-size: 0.6rem; color: #888; }
        .bal-card b { font-size: 1rem; display: block; }
        .bal-card.profit { color: var(--profit); border-color: var(--profit); }
        .bal-card.loss { color: var(--red); border-color: var(--red); }

        /* Modals */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-box { background: #111; width: 100%; max-width: 380px; padding: 25px; border-radius: 20px; border: 1px solid var(--border); }
        input, select { width: 100%; padding: 12px; margin-bottom: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 10px; font-family: 'Poppins'; }

        /* History Items */
        .hist-card { background: #111; padding: 12px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid #333; }
        .hist-win { border-left-color: var(--profit); }
        .hist-loss { border-left-color: var(--red); }
    </style>
</head>
<body>

    <header>
        <div class="header-info">
            <h1>SQL TOURNAMENT PRO</h1>
        </div>
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="pfp-nav" id="nav-pfp-icon" onclick="openSidebar()">
    </header>

    <div class="nav-scroll">
        <button class="nav-btn active" onclick="setFilter('ALL', this)">LIVE MATCHES</button>
        <button class="nav-btn" onclick="setFilter('CS', this)">CS MODE</button>
        <button class="nav-btn" onclick="setFilter('BR', this)">BR FULL MAP</button>
        <button class="nav-btn" onclick="setFilter('LONE', this)">LONE WOLF</button>
        <button class="nav-btn" onclick="showHistory()">MY HISTORY</button>
        <button class="nav-btn" onclick="showWhitePaper()">WHITE PAPER</button>
    </div>

    <main class="match-grid" id="match-list"></main>

    <div id="sidebar">
        <div class="profile-section">
            <div class="pfp-container">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" id="main-pfp" class="pfp-main">
                <label for="pfp-file" class="pfp-upload-icon"><i class="fas fa-camera"></i></label>
                <input type="file" id="pfp-file" hidden accept="image/*" onchange="handlePFP(this)">
            </div>
            <h2 id="profile-name" style="margin:10px 0 0;">Guest User</h2>
            <p id="profile-uid" style="font-size:0.6rem; color:#666;">Not Logged In</p>

            <div class="balance-grid">
                <div class="bal-card profit"><span>ALL TIME PROFIT</span><b id="val-profit">₹0</b></div>
                <div class="bal-card loss"><span>ALL TIME LOSS</span><b id="val-loss">₹0</b></div>
            </div>
        </div>

        <button class="btn-join" id="auth-btn" style="margin-bottom:10px" onclick="openAuth()">LOGIN / REGISTER</button>
        <button class="btn-join" style="background:#222; color:#fff" onclick="closeSidebar()">CLOSE MENU</button>
    </div>

    <div id="modal-auth" class="modal">
        <div class="modal-box" id="step-register">
            <h3 style="text-align:center; color:var(--gold);">REGISTER</h3>
            <input type="text" id="in-name" placeholder="Full Name">
            <input type="email" id="in-email" placeholder="Gmail ID">
            <input type="text" id="in-phone" placeholder="+91 Phone Number">
            <input type="text" id="in-gameid" placeholder="Free Fire UID">
            <input type="text" id="in-gamename" placeholder="Game Nickname">
            <div id="recaptcha-container"></div>
            <button class="btn-join" onclick="actionSendOTP()">SEND OTP</button>
        </div>
        <div class="modal-box" id="step-otp" style="display:none;">
            <h3 style="text-align:center; color:var(--accent);">VERIFY OTP</h3>
            <input type="number" id="in-otp" placeholder="Enter 6 Digit Code" style="text-align:center; letter-spacing:5px;">
            <button class="btn-join" onclick="actionVerifyOTP()">VERIFY & START</button>
        </div>
    </div>

    <div id="modal-pay" class="modal">
        <div class="modal-box">
            <h3 style="text-align:center; margin-bottom:15px;">MATCH PAYMENT</h3>
            <div style="background:#000; padding:12px; border-radius:10px; text-align:center; border:1px dashed var(--gold); margin-bottom:15px;">
                <span style="font-size:0.55rem; color:#666;">SEND MONEY TO UPI</span><br>
                <b style="color:var(--accent); font-size:0.85rem;">rizwanhasan90122778623@ybl</b>
            </div>
            <input type="text" id="p-utr" placeholder="12 Digit UTR Number">
            <input type="number" id="p-amt" placeholder="Enter Paid Amount">
            <label style="font-size:0.6rem; color:#888; display:block; margin-bottom:5px;">Upload Payment Screenshot:</label>
            <input type="file" id="p-ss" accept="image/*">
            <button class="btn-join" id="p-submit" onclick="actionSubmitPay()">SUBMIT PAYMENT</button>
            <button class="btn-join" style="background:none; color:var(--red); margin-top:10px;" onclick="closeModals()">CANCEL</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, setDoc, getDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBvObxADcAior6R_or9O6UmWsFT8do1GkI",
            authDomain: "sqladmin-ff04d.firebaseapp.com",
            projectId: "sqladmin-ff04d",
            storageBucket: "sqladmin-ff04d.appspot.com",
            messagingSenderId: "539086978850",
            appId: "1:539086978850:web:261e6a0cf3c9a2aa29ef7b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        let currentUser = JSON.parse(localStorage.getItem('sql_user_data')) || null;
        let activeFilter = 'ALL';
        let otpResult = null;

        // --- AUTH & OTP LOGIC ---
        window.actionSendOTP = async () => {
            const phone = document.getElementById('in-phone').value;
            if(!phone.includes('+91')) return alert("Enter number with +91");
            window.recaptcha = new RecaptchaVerifier(auth, 'recaptcha-container', {size: 'invisible'});
            try {
                otpResult = await signInWithPhoneNumber(auth, phone, window.recaptcha);
                document.getElementById('step-register').style.display = 'none';
                document.getElementById('step-otp').style.display = 'block';
            } catch(e) { alert(e.message); }
        };

        window.actionVerifyOTP = async () => {
            const code = document.getElementById('in-otp').value;
            try {
                const res = await otpResult.confirm(code);
                const userData = {
                    uid: res.user.uid,
                    name: document.getElementById('in-name').value,
                    email: document.getElementById('in-email').value,
                    phone: document.getElementById('in-phone').value,
                    gameId: document.getElementById('in-gameid').value,
                    gameName: document.getElementById('in-gamename').value,
                    pfp: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                    profit: 0, loss: 0
                };
                await setDoc(doc(db, "users", res.user.uid), userData);
                localStorage.setItem('sql_user_data', JSON.stringify(userData));
                location.reload();
            } catch(e) { alert("Invalid OTP!"); }
        };

        // --- PROFILE PHOTO LOGIC ---
        window.handlePFP = async (input) => {
            if(!currentUser) return alert("Login First!");
            const file = input.files[0];
            const sRef = ref(storage, `profiles/${currentUser.uid}`);
            
            // UI Feedback
            document.getElementById('main-pfp').style.opacity = "0.5";
            
            await uploadBytes(sRef, file);
            const url = await getDownloadURL(sRef);
            
            // Update Database & LocalStorage
            currentUser.pfp = url;
            await setDoc(doc(db, "users", currentUser.uid), { pfp: url }, { merge: true });
            localStorage.setItem('sql_user_data', JSON.stringify(currentUser));
            
            // Update UI
            document.getElementById('main-pfp').src = url;
            document.getElementById('nav-pfp-icon').src = url;
            document.getElementById('main-pfp').style.opacity = "1";
        };

        // --- MATCH RENDERING ---
        function renderMatches() {
            onSnapshot(collection(db, "matches"), snap => {
                const list = document.getElementById('match-list');
                list.innerHTML = "";
                snap.forEach(d => {
                    const m = d.data();
                    if(activeFilter !== 'ALL' && m.type !== activeFilter) return;
                    const left = m.total - m.joined;
                    list.innerHTML += `
                    <div class="m-card">
                        <div class="m-type-tag">${m.type}</div>
                        <img src="https://staticg.sportskeeda.com/editor/2022/03/f305e-16475141042780-1920.jpg" class="m-img">
                        <div class="m-content">
                            <b class="m-title">${m.map} #${d.id.slice(-4)}</b>
                            <div class="m-stats">
                                <div class="stat-item"><span>WIN</span><b class="win-amt">₹${m.win}</b></div>
                                <div class="stat-item"><span>ENTRY</span><b class="entry-amt">₹${m.entry}</b></div>
                            </div>
                            <div class="slot-box">
                                <div class="slot-bar"><div class="slot-fill" style="width:${(m.joined/m.total)*100}%"></div></div>
                                <div class="slot-info"><span>${m.joined}/${m.total}</span><span class="waiting-text">${left} Waiting</span></div>
                            </div>
                            <button class="btn-join" onclick="openPay('${d.id}', ${m.entry})">JOIN NOW</button>
                        </div>
                    </div>`;
                });
            });
        }

        // --- PAYMENT LOGIC ---
        let currentMatchId = null;
        window.openPay = (id, amt) => {
            if(!currentUser) return openAuth();
            currentMatchId = id;
            document.getElementById('p-amt').value = amt;
            document.getElementById('modal-pay').style.display = 'flex';
        };

        window.actionSubmitPay = async () => {
            const utr = document.getElementById('p-utr').value;
            const file = document.getElementById('p-ss').files[0];
            if(utr.length < 10 || !file) return alert("Fill all details & Proof!");

            const btn = document.getElementById('p-submit');
            btn.disabled = true; btn.innerText = "Processing...";

            const ssRef = ref(storage, `payments/${Date.now()}`);
            await uploadBytes(ssRef, file);
            const ssUrl = await getDownloadURL(ssRef);

            await addDoc(collection(db, "payments"), {
                userId: currentUser.uid,
                userName: currentUser.name,
                userGameId: currentUser.gameId,
                matchId: currentMatchId,
                utr: utr,
                amount: document.getElementById('p-amt').value,
                ss: ssUrl,
                status: 'pending',
                timestamp: Date.now()
            });

            alert("Payment Data Sent to Admin!");
            location.reload();
        };

        // --- HELPERS ---
        window.setFilter = (f, el) => {
            activeFilter = f;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            renderMatches();
        };

        window.openSidebar = () => {
            document.getElementById('sidebar').style.left = '0';
            if(currentUser) {
                document.getElementById('profile-name').innerText = currentUser.name;
                document.getElementById('profile-uid').innerText = "UID: " + currentUser.gameId;
                document.getElementById('val-profit').innerText = "₹" + currentUser.profit;
                document.getElementById('val-loss').innerText = "₹" + currentUser.loss;
                document.getElementById('main-pfp').src = currentUser.pfp;
                document.getElementById('nav-pfp-icon').src = currentUser.pfp;
                document.getElementById('auth-btn').style.display = 'none';
            }
        };

        window.closeSidebar = () => document.getElementById('sidebar').style.left = '-100%';
        window.openAuth = () => document.getElementById('modal-auth').style.display = 'flex';
        window.closeModals = () => document.querySelectorAll('.modal').forEach(m => m.style.display='none');
        window.showWhitePaper = () => alert("SQL TOURNAMENT RULES\n1. No Hacks\n2. Real Details Only\n3. Proof needed for victory.");

        renderMatches();
    </script>
</body>
</html>
